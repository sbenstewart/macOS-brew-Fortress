.\" Automatically generated by Pandoc 1.16.0.2
.\"
.TH "ADBLOCK2PRIVOXY" "1" "2016\-02\-12" "adblock2privoxy 1.4.2" "General Commands Manual"
.hy
.SH ADBLOCK2PRIVOXY
.PP
\f[B]Convert adblock config files to privoxy format\f[]
.SS Synopsis
.RS
.PP
adblock2privoxy [OPTION...] [URL...]
.RE
.SS Objectives
.PP
AdBlock Plus browser plugin has great block lists provided by big
community, but it is client software and cannot work on a server as a
proxy.
.PP
Privoxy proxy has good potential to block ads at server side, but it
experiences acute shortage of updated block lists.
.PP
This software converts adblock lists to privoxy config files format.
.PP
Almost all adblock features are supported including
.RS
.IP \[bu] 2
block/unblock requests (on privoxy)
.RS 2
.IP \[bu] 2
all syntax features are supported except for regex templates matching
host name
.RE
.IP \[bu] 2
hide/unhide page elements (via CSS)
.RS 2
.IP \[bu] 2
all syntax features are supported
.RE
.IP \[bu] 2
all block request options except for outdated ones:
.RS 2
.IP \[bu] 2
Supported: script, image, stylesheet, object, xmlhttprequest,
object\-subrequest, subdocument,document, elemhide, other, popup,
third\-party, domain=..., match\-case, donottrack
.IP \[bu] 2
Unsupported: collapse, background, xbl, ping and dtd
.RE
.RE
.PP
Tested with privoxy version 3.0.21.
Element hiding (https://adblockplus.org/filters#elemhide) feature
requires a webserver to serve CSS files.
See Nginx and Apache config examples provided.
.SS Description
.PP
Adblock files specified by [URL]...
are converted to privoxy config files and auxiliarly elemHide CSS files.
Local file names and http(s) addresses are accepted as URLs.
.PP
If no source URLs are specified, task file is used to determine sources:
previously processed sources are processed again if any of them is
expired.
Nothing is done if all sources in the task file are up to date.
.SS Options
.RS
.TP
.B \-v, \-\-version
Show version number
.RS
.RE
.TP
.B \-p PATH, \-\-privoxyDir=PATH
Privoxy config output path
.RS
.RE
.TP
.B \-w PATH, \-\-webDir=PATH
Css files output path
.RS
.RE
.TP
.B \-d DOMAIN, \-\-domainCSS=DOMAIN
Domain of CSS web server (required for Element Hide functionality)
.RS
.RE
.TP
.B \-t PATH, \-\-taskFile=PATH
Path to task file containing urls to process and options.
.RS
.RE
.TP
.B \-f, \-\-forced
Run even if no sources are expired
.RS
.RE
.RE
.PP
If \f[C]taskFile\f[] is not specified explicilty,
\f[C][privoxyDir]/ab2p.task\f[] is used.
.PP
If task file exists and \f[C]privoxyDir\f[], \f[C]webDir\f[] or
\f[C]domainCSS\f[] is not specified, corresponding value is taken from
task file.
.PP
If \f[C]webDir\f[] is not specified and cannot be taken from task file,
\f[C]privoxyDir\f[] value is used for \f[C]webDir\f[].
.PP
If \f[C]domainCSS\f[] is not specified and cannot be taken from task
file, Element Hide (https://adblockplus.org/filters#elemhide)
\f[B]functionality become disabled\f[].
No webserver is needed in this case.
.PP
\f[C]domainCSS\f[] can contain just IP address if CSS web server has no
associated domain.
Use \f[C]localhost\f[] or \f[C]127.0.0.1\f[] if you run your browser on
the same machine with webserver.
.SS Usage
.PP
Example of first run:
.IP
.nf
\f[C]
adblock2privoxy\ \-p\ /etc/privoxy\ \-w\ /var/www/privoxy\ \-d\ www.example.com\ \-t\ my_ab2b.task\ https://easylist\-downloads.adblockplus.org/easylist.txt\ https://easylist\-downloads.adblockplus.org/advblock.txt\ my_custom.txt
\f[]
.fi
.PP
Example of subsequent runs:
.IP
.nf
\f[C]
adblock2privoxy\ \-t\ my_ab2b.task
\f[]
.fi
.PP
The app generates following files
.RS
.IP \[bu] 2
privoxyDir:
.RS 2
.IP \[bu] 2
ab2p.system.action
.IP \[bu] 2
ab2p.action
.IP \[bu] 2
ab2p.system.filter
.IP \[bu] 2
ab2p.filter
.RE
.IP \[bu] 2
webDir:
.RS 2
.IP \[bu] 2
ab2p.common.css
.IP \[bu] 2
ab2p.css
.IP \[bu] 2
[lot of directories for all levels of domain names]
.RE
.IP \[bu] 2
taskFile:
.RS 2
.IP \[bu] 2
special file containing execution details.
It can be reused to update privoxy config from same sources with same
options.
Its name is \f[C]ab2p.task\f[] by default.
.RE
.RE
.SS How to apply results
.IP "1." 3
Install privoxy.
Optionally setup it as transparent proxy.
See privoxy installation
manual (http://www.privoxy.org/user-manual/installation.html) for
details.
.IP "2." 3
Change privoxy config file located in
.RS 4
.RS
.IP \[bu] 2
\f[C]/etc/privoxy/config\f[] for linux
.IP \[bu] 2
\f[C]C:\\Program\ Files\\Privoxy\\config.txt\f[] for windows
.PP
Add following lines:
.IP
.nf
\f[C]
actionsfile\ ab2p.system.action
actionsfile\ ab2p.action
filterfile\ ab2p.system.filter
filterfile\ ab2p.filter
\f[]
.fi
.RE
.RE
.IP "3." 3
In order to make Element
hiding (https://adblockplus.org/filters#elemhide) work you also need a
webserver to serve CSS files.
You can choose nginx, apache or any other webserver.
See nginx installation
manual (https://www.nginx.com/resources/wiki/start/topics/tutorials/install/),
apache on linux installation
manual (https://httpd.apache.org/docs/2.4/install.html) or apache on
windows intallation
manual (http://www.thesitewizard.com/apache/install-apache-2-windows.shtml)
for details.
.IP "4." 3
Change webserver config.
In examples below
.RS 4
.IP \[bu] 2
replace \f[C]www.example.com\f[] with your domain or IP address (equal
to \f[C]\-\-domainCSS\f[] adblock2privoxy parameter)
.IP \[bu] 2
replace \f[C]/var/www/privoxy\f[] with your CSS files location (equal to
\f[C]\-\-webDir\f[] adblock2privoxy parameter)
.IP \[bu] 2
remember, these examples are simplified to use by unexperienced people.
If you\[aq]re familiar with webservers administration, you\[aq]ll find
better ways to apply these configs.
.PP
Nginx config: add following lines into http section of
\f[C]nginx.conf\f[] file
.RS
.IP \[bu] 2
for linus \f[C]/etc/nginx/nginx.conf\f[]
.IP \[bu] 2
for windows \f[C][nginx\ location]\\conf\\nginx.conf\f[]
.IP
.nf
\f[C]
server\ {
\ \ \ \ \ \ listen\ 80;
\ \ \ \ \ \ #ab2p\ css\ domain\ name\ (optional,\ should\ be\ equal\ to\ \-\-domainCSS\ parameter)
\ \ \ \ \ \ server_name\ www.example.com;

\ \ \ \ \ \ #root\ =\ \-\-webDir\ parameter\ value
\ \ \ \ \ \ root\ /var/www/privoxy;

\ \ \ \ \ \ location\ ~\ ^/[^/.]+\\..+/ab2p.css$\ {
\ \ \ \ \ \ \ \ \ \ #\ first\ reverse\ domain\ names\ order
\ \ \ \ rewrite\ ^/([^/]*?)\\.([^/.]+)(?:\\.([^/.]+))?(?:\\.([^/.]+))?(?:\\.([^/.]+))?(?:\\.([^/.]+))?(?:\\.([^/.]+))?(?:\\.([^/.]+))?(?:\\.([^/.]+))?/ab2p.css$\ /$9/$8/$7/$6/$5/$4/$3/$2/$1/ab2p.css\ last;
\ \ \ \ \ \ }

\ \ \ \ \ \ location\ ~\ (^.*/+)[^/]+/+ab2p.css\ {
\ \ \ \ \ \ \ \ \ \ #\ then\ try\ to\ get\ CSS\ for\ current\ domain
\ \ \ \ \ \ \ \ \ \ #\ if\ it\ is\ unavailable\ \-\ get\ CSS\ for\ parent\ domain
\ \ \ \ \ \ \ \ \ \ try_files\ $uri\ $1ab2p.css;
\ \ \ \ \ \ }
}
\f[]
.fi
.RE
.PP
Apache config: put following lines into
.RS
.IP \[bu] 2
for linux: \f[C]/etc/apache2/sites\-available/000\-default.conf\f[]
(replace existing content)
.IP \[bu] 2
for windows:
\f[C]C:\\Program\ Files\\Apache\ Group\\Apache2\\conf\\httpd.conf\f[]
(append to the end)
.IP
.nf
\f[C]
<VirtualHost\ *:80>
\ \ \ \ \ \ #ab2p\ css\ domain\ name\ (optional,\ should\ be\ equal\ to\ \-\-domainCSS\ parameter)
\ \ \ \ \ \ ServerName\ www.example.com

\ \ \ \ \ \ #root\ =\ \-\-webDir\ parameter\ value
\ \ \ \ \ \ DocumentRoot\ /var/www/privoxy


\ \ \ \ \ \ RewriteEngine\ on

\ \ \ \ \ \ #\ first\ reverse\ domain\ names\ order
\ \ \ \ \ \ RewriteRule\ ^/([^/]*?)\\.([^/.]+)(?:\\.([^/.]+))?(?:\\.([^/.]+))?(?:\\.([^/.]+))?(?:\\.([^/.]+))?(?:\\.([^/.]+))?(?:\\.([^/.]+))?(?:\\.([^/.]+))?/ab2p.css$\ /$9/$8/$7/$6/$5/$4/$3/$2/$1/ab2p.css\ [N]

\ \ \ \ \ \ #\ then\ try\ to\ get\ CSS\ for\ current\ domain
\ \ \ \ \ \ #\ if\ it\ is\ unavailable\ \-\ get\ CSS\ for\ parent\ domain
\ \ \ \ \ \ RewriteCond\ %{DOCUMENT_ROOT}/%{REQUEST_FILENAME}\ !\-f
\ \ \ \ \ \ RewriteRule\ (^.*/+)[^/]+/+ab2p.css$\ $1ab2p.css\ [N]
</VirtualHost>
\f[]
.fi
.RE
.RE
.IP "5." 3
Get adblock2privoxy output
.RS 4
.RS
.IP \[bu] 2
Either run adblock2privoxy providing privoxy dir, web dir, domain and
adblock input file urls such as
.RS 2
.IP \[bu] 2
EasyList (https://easylist.adblockplus.org/en/)
.IP \[bu] 2
Russian AD list (https://code.google.com/p/ruadlist/)
.IP \[bu] 2
and many others from official adblock
repository (https://easylist.adblockplus.org/en/)
.RE
.IP \[bu] 2
Or just download processed lists from downloads
page (https://projects.zubr.me/wiki/adblock2privoxyDownloads) and unpack
\f[C]privoxy\f[] to and \f[C]web\f[] directories content into
.RS 2
.IP \[bu] 2
\f[C]/var/www/privoxy\f[] and \f[C]/var/www/privoxy\f[] for linux
.IP \[bu] 2
\f[C]C:\\Program\ Files\\Privoxy\f[] and
\f[C][your\ webserver\ directory]\f[] for windows
.RE
.RE
.RE
.IP "6." 3
Restart privoxy and webserver to load updated configs
.SS Contribution
.IP \[bu] 2
Clone repository from <http://projects.zubr.me/adblock2privoxy.git>.
.IP \[bu] 2
Report bugs (https://projects.zubr.me/newticket?project=adblock2privoxy)
.SH AUTHORS
Alexey Zubritsky <adblock2privoxy\@zubr.me>.
